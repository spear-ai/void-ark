# Panamax

Panamax is a tool to mirror the Rust and crates.io repositories, for offline usage of rustup and cargo.

## Mirrors Directory
## Mirrors Directory
This directory has multiple generated files. The source of truth is the `vendor` directory. This directory is generated from the source code via `cargo vendor [Options] [Path]`, and contains some binaries for the required packages of the project.

The other directories are all generated by panamax within the docker-compose provided. Make sure you have the panamaxrs/panamax container installed if you are doing this offline.

## How to use

### On Panamax Host

If you already have a filled out mirrors directory:
If you already have a filled-out mirrors directory:
Simple! You just need to run the docker compose to pull up the container and point it to it! Some key points to note:
- Make sure that you're mounting the correct directory; this can be edited in the docker-compose file. If it doesn't exist, one will be made for you
- Note the IP / Hostname of the panamax host for the clients
If you dont have a filled out mirrors directory:

- If you dont have a vendors directory:

    ```bash
    cargo vendor --manifest-path /path/to/intended/Cargo.toml ./mirrors/vendor # Create a vendors directory to have the binaries
    ```

    Initialize the panamax files needed to host

    ```bash
    docker run --rm -it -v ./mirrors:/mirror --user $(id -u) panamaxrs/panamax init /mirror # This will initialize the directory and prep it for the sync
    ```

    Now you should edit the ./mirrors/mirror.toml to include what you want. For Modernization suggested changes are:
  - line 52:

    ```toml
    keep_latest_stables = 0
    keep_latest_betas = 0
    keep_latest_nightlies = 0
    ```

  - line 69:

    ```toml
    pinned_rust_versions = [
        "1.87"
    ] 
    ```

  - line 78:

    ```toml
    platforms_unix = [
        "x86_64-unknown-linux-gnu",
        "i686-unknown-linux-gnu",
    ]
    ```

    Now we sync! This will ensure that we have the files we need (rustup/cargo binaries)

    ```bash
    docker run --rm -it -v ./mirrors:/mirror --user $(id -u) panamaxrs/panamax sync /mirror /mirror/vendor # This syncs the mirror with the vendor folder
    ```

#### To Run Panamax

Simply `docker-compose up`  (Will update when podman equivalent is available)

Now the site should be hosted on localhost:8080 / this computers ip!

### On Panamax Client

Go to the IP of the host panamax at port 8080 (unless you changed this in the compose) on a browser http://{host-ip}:8080.

Instructions to set up cargo for panamax will be shown on the site. If you need cargo then be sure to select the correct rustup distribution and initialize it first!
