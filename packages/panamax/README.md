# Panamax

Panamax is a tool to mirror the Rust and crates.io repositories, for offline usage of rustup and cargo.

## Mirrors Directory

This directory has multiple generated files. The source of truth is the `vendor` directory. This directory is generated from the source code via `cargo vendor [Options] [Path]`, and contains some binaries for the required packages of the project.

The other directories are all generated by panamax within the docker-compose provided. Make sure you have the panamaxrs/panamax container installed if you are doing this offline.

## How to use

### On Panamax Host

If you already have a filled-out mirrors directory:
You just need to run the docker compose to pull up the container and point it to it, some key points to note:

- Make sure that you're mounting the correct directory; this can be edited in the docker-compose file. If it doesn't exist, one will be made for you
- Note the IP / Hostname of the panamax host for the clients
If you don't have a filled-out mirrors directory:

- If you don't have a vendor directory:

    ```bash
    cargo vendor --manifest-path /path/to/project/Cargo.toml ./mirrors/vendor # Create a vendor directory to have the binaries
    ```

    Initialize the panamax files needed to host

    ```bash
    docker run --rm -it -v ./mirrors:/mirror --user $(id -u) panamaxrs/panamax init /mirror # This will initialize the directory and prep it for the sync
    ```

    Now you should edit the ./mirrors/mirror.toml to include what you want. For Modernization suggested changes are:
  - line 52:

    ```toml
    keep_latest_stables = 1
    keep_latest_betas = 0
    keep_latest_nightlies = 0
    ```

  - line 78: which linux distributions to download

    ```toml
    platforms_unix = [
         "x86_64-unknown-linux-gnu",
         "i686-unknown-linux-gnu",
         "aarch64-unknown-linux-gnu",
    ]
    ```

  - line 89: To not download windows

    ```toml
    platforms_windows = [
    #     "x86_64-pc-windows-gnu",
    #     "x86_64-pc-windows-msvc",
    ]
    ```

    Now we sync. This will ensure that we have the files we need (rustup/cargo binaries).

    ```bash
    docker run --rm -it -v ./mirrors:/mirror --user $(id -u) panamaxrs/panamax sync --vendor-path /mirror/vendor /mirror # This syncs the mirror with the vendor folder
    ```

#### To Run Panamax

Simply `docker-compose up`  (Will update when podman equivalent is available)

Now the site should be hosted on http://localhost:8080 / http://{host-ip}:8080

### On Panamax Client

Go to the IP of the host panamax at port 8080 (unless you changed this in the compose) on a browser http://{host-ip}:8080

Instructions to set up cargo for panamax will be shown on the site, if you need cargo then be sure to select the correct rustup distribution and initialize it first.
